# 12.将测试集成到管道中

测试是软件交付过程中非常重要的一个方面。为了保证交付的软件项目或产品的质量，一些测试类型可以很容易地自动化，并与构建和发布管道相集成。

在这一章中，我们将会看到可以自动化的测试类型，以及我们可以用来有效运行管道自动化测试的特性和组件。

## 第 12.01 课:使用管道运行单元测试

用单元测试验证应用程序的代码以确保代码按预期运行是很重要的。实现单元测试是为了测试开发人员使用测试驱动开发方法(TDD)和行为驱动开发(BDD)编写的代码。

构建管道可以用来执行用许多类型的单元测试工具编写的单元测试。通常的做法是构建代码，然后执行单元测试，并将代码打包成可部署的二进制文件。要使用构建管道执行测试，您可以找到几个可用的任务。见图 [12-1](#Fig1) 。

![../images/493403_1_En_12_Chapter/493403_1_En_12_Fig1_HTML.jpg](../images/493403_1_En_12_Chapter/493403_1_En_12_Fig1_HTML.jpg)

图 12-1

测试任务

使用 Visual Studio 测试任务，您可以执行使用测试框架(如 MSTest、xUnit、NUnit 等)开发的多种类型的测试。该任务允许您在代理作业中使用多代理配置的同时，将测试分布在多个代理中，以便高效地运行它们。

还有其他任务，如 dotnet 命令行任务，允许您运行 dotnet 测试来执行使用开发的测试。NET 核心。命令行任务可用于执行机器学习代码单元测试运行等任务。见图 [12-2](#Fig2) 。

![../images/493403_1_En_12_Chapter/493403_1_En_12_Fig2_HTML.jpg](../images/493403_1_En_12_Chapter/493403_1_En_12_Fig2_HTML.jpg)

图 12-2

运行 Python 测试

当从 VS 测试任务或 dotnet 测试运行测试时，测试运行的结果会自动发布到管道。但是，如果您使用命令行执行测试，例如 Python 测试，则可能需要将测试结果的输出发布到管道，以便结果显示在已执行构建的 test 选项卡中。若要发布测试结果，可以使用“发布测试结果”任务，并指定测试执行的结果输出文件和测试结果的格式，以便将其发布到管道。见图 [12-3](#Fig3) 。

![../images/493403_1_En_12_Chapter/493403_1_En_12_Fig3_HTML.jpg](../images/493403_1_En_12_Chapter/493403_1_En_12_Fig3_HTML.jpg)

图 12-3

发布测试结果

在本课中，我们讨论了如何利用可用于管道的任务，通过构建管道来设置单元测试执行。

## 第 12.02 课:使用管道运行功能测试

集成和功能测试用于测试部署的应用程序。它们可能被实现为使用不同测试框架的 API 级测试或用户界面测试。Selenium 是广泛使用的主要测试框架之一。Net 等语言。还有其他的测试框架，比如 Cypress，它也在促进基于场景的功能 UI 测试实现。

测试应用程序的自动化功能测试应该在部署到给定目标后执行，以确保目标应用程序按预期运行。自动化和使用部署管道运行自动化的功能测试使团队能够为每个版本运行他们的大部分测试，从而在交付的应用程序中实现更高的质量。

基于 Selenium 的功能测试要求您以交互模式运行代理来执行测试。我们在本书第 3 章中讨论了如何设置代理。然而，Cypress 框架 UI 测试也可以用非交互式代理来执行。

要执行基于 Selenium 的测试，您可以利用虚拟机或物理机中的代理设置作为交互式代理。这样的代理应该为 Visual Studio 测试平台安装程序任务的测试执行做好准备。见图 [12-4](#Fig4) 。

![../images/493403_1_En_12_Chapter/493403_1_En_12_Fig4_HTML.jpg](../images/493403_1_En_12_Chapter/493403_1_En_12_Fig4_HTML.jpg)

图 12-4

VS 测试平台安装程序

然后，您可以使用 VS 测试任务来执行使用 C#用 Selenium 编写的测试。如果您已经用 Java 开发了测试，那么您可以使用 Maven 任务来执行发布管道中的测试。

测试执行可能需要您使用虚拟机作为测试客户端，尤其是当您需要运行交互式代理时。您可能需要设置多台测试客户机来有效地分发和运行您的功能测试。然而，保持这些虚拟机在诸如 Azure 的云平台中持续运行将是昂贵的。为了最小化成本，您可以在测试执行之前设置机器的按需启动；一旦测试执行完成，关闭测试客户端，这样云平台上的费用将被最小化。见图 [12-5](#Fig5) 。

![../images/493403_1_En_12_Chapter/493403_1_En_12_Fig5_HTML.jpg](../images/493403_1_En_12_Chapter/493403_1_En_12_Fig5_HTML.jpg)

图 12-5

测试客户端按需启动和停止

在本课中，我们讨论了使用发布管道来执行功能测试。

## 摘要

在这一章中，我们讨论了使用单元测试和功能测试来确保所交付的应用程序的质量。

在本书中，我们讨论了关于 Azure pipelines 的几个重要事实。在介绍性章节中，我们已经讨论了为什么我们需要实现持续集成和交付。然后，我们探讨了代理池和代理，甚至部署设置。接下来，我们将在接下来的几章中详细讨论经典的构建管道。还讨论了 YAML 管道，使您能够理解管道作为代码的用法。除此之外，我们还讨论了发布管道的使用，以及在发布和构建管道中测试执行的实现和使用。总的来说，这本书让你对实现和使用 Azure pipelines 有了基本的了解，使你能够快速部署软件应用程序，同时不影响所交付的应用程序的质量。